//@ui5-bundle userform/Component-preload.js
sap.ui.require.preload({
	"userform/Component.js":function(){
sap.ui.define(["sap/ui/core/UIComponent","userform/model/models"],(e,t)=>{"use strict";return e.extend("userform.Component",{metadata:{manifest:"json",interfaces:["sap.ui.core.IAsyncContentCreation"]},init(){e.prototype.init.apply(this,arguments);this.setModel(t.createDeviceModel(),"device");this.getRouter().initialize()}})});
},
	"userform/controller/App.controller.js":function(){
sap.ui.define(["sap/ui/core/mvc/Controller"],e=>{"use strict";return e.extend("userform.controller.App",{onInit(){}})});
},
	"userform/controller/UserForm.controller.js":function(){
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/BusyIndicator"],function(e,t,r,s,o){"use strict";return e.extend("userform.controller.UserForm",{onInit:function(){this._initAddressCache();this._initModels();this._loadUserData()},_initModels:function(){const e=new t({Email:"",Firstname:"",Lastname:"",ContractType:"variable",EnergyRate:null});this.getView().setModel(e,"userProfile");const r=new t({ID:null,Date:null,Time:null,Price:0});this.getView().setModel(r,"energyRate");const s=this.getView();s.attachEventOnce("afterRendering",this._updateContractTypeUI,this);const o=new t({PanelsAmount:0,ModulesPower:0,PanelAngle:30,PanelAzimuth:180,ID:null});this.getView().setModel(o);this.getView().setModel(new t({suggestions:[],selectedAddress:{latitude:"",longitude:"",displayName:""}}),"address");this.getView().setModel(new t({formMode:"create",isBusy:false,hasValidationErrors:false,dataLoaded:false}),"viewState")},_loadUserData:function(){o.show();const e=this.getView().getModel("viewState");e.setProperty("/isBusy",true);this._fetchUserProfile().then(()=>this._fetchEnergyRate()).then(()=>this._fetchSolarConfig()).then(()=>{e.setProperty("/dataLoaded",true);e.setProperty("/isBusy",false);this._updateContractTypeUI();o.hide()}).catch(t=>{console.error("Error loading user data:",t);r.error("Kon gebruikersgegevens niet laden: "+t.message);e.setProperty("/isBusy",false);o.hide()})},_fetchUserProfile:function(){return new Promise((e,t)=>{$.ajax({url:"/userform/getUserProfile()",type:"GET",success:t=>{if(t){const e=this.getView().getModel("userProfile");e.setData(t);const r=this.getView().getModel("viewState");if(t.ID){r.setProperty("/formMode","update")}}e()},error:e=>t(e)})})},_fetchEnergyRate:function(){return new Promise((e,t)=>{const r=this.getView().getModel("userProfile").getProperty("/ContractType");if(r!=="fixed"){e();return}$.ajax({url:"/userform/getuserEnergyRate()",type:"GET",success:t=>{if(t){const e=this.getView().getModel("energyRate");e.setData(t);const r=this.byId("energyPriceInput");if(r){r.setValue(t.Price)}}e()},error:t=>{console.warn("Error fetching energy rate, but continuing:",t);e()}})})},_fetchSolarConfig:function(){return new Promise((e,t)=>{$.ajax({url:"/userform/getUserSolarConfig()",type:"GET",success:t=>{if(t){const e=this.getView().getModel();const r=this.getView().getModel("address");e.setData({PanelsAmount:t.PanelAmount,ModulesPower:t.ModulePower,PanelAngle:t.PanelAngle,PanelAzimuth:t.PanelAzimuth,ID:t.ID});r.setProperty("/selectedAddress",{latitude:t.Latitude,longitude:t.Longitude,displayName:t.Location});const s=this.getView().getModel("viewState");s.setProperty("/formMode","update")}e()},error:e=>t(e)})})},_initAddressCache:function(){this._addressCache=this._addressCache||new Map},onSuggestAddress:async function(e){const t=(e.getParameter("suggestValue")||"").trim();const r=this.getView().getModel("address");if(t.length<2){r.setProperty("/suggestions",[]);return}if(this._addressCache.has(t)){r.setProperty("/suggestions",this._addressCache.get(t));return}if(this._suggestionAbortController){this._suggestionAbortController.abort()}this._suggestionAbortController=new AbortController;try{const e=encodeURIComponent(t);const s=await fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json&addressdetails=1&countrycodes=be&limit=5`,{headers:{"User-Agent":"EnergyManagementSystem/1.0"},signal:this._suggestionAbortController.signal});if(!s.ok)throw new Error("Network error");const o=await s.json();const n=o.map(e=>({description:this._formatAddress(e),lat:e.lat,lon:e.lon,displayName:e.display_name||this._formatAddress(e)}));this._addressCache.set(t,n);r.setProperty("/suggestions",n)}catch(e){if(e.name!=="AbortError"){console.error("Address suggestion error:",e);s.show("Adres suggesties konden niet worden opgehaald")}}},_formatAddress:function(e){const t=e.address||{};const r=[[t.road,t.house_number].filter(Boolean).join(" "),t.postcode,t.city].filter(Boolean);return r.length>0?r.join(", "):e.display_name},onAddressSelected:function(e){const t=e.getParameter("selectedItem");if(!t)return;const r=t.getBindingContext("address");if(!r)return;const s=r.getObject();const o=this.getView().getModel("address");const n=parseFloat(parseFloat(s.lat).toFixed(6));const a=parseFloat(parseFloat(s.lon).toFixed(6));o.setProperty("/selectedAddress",{latitude:n,longitude:a,displayName:s.description||s.displayName})},onSavePress:function(){if(!this._validateForm()){s.show("Vul alle verplichte velden in");return}o.show();this._updateUserProfile().then(()=>{const e=this.getView().getModel("userProfile").getData();if(e.ContractType==="fixed"){const e=parseFloat(this.byId("energyPriceInput").getValue());if(isNaN(e)||e<=0||e>1){s.show("Voer een geldige energieprijs in (tussen 0 en 1)");o.hide();return Promise.reject(new Error("Invalid energy price"))}return new Promise(t=>{setTimeout(()=>{this._updateEnergyRate(e).then(e=>{console.log("Energy rate updated:",e);t()}).catch(e=>{console.error("Error updating energy rate:",e);r.error("Fout bij opslaan energieprijs: "+e.message);t()})},100)})}return Promise.resolve()}).then(()=>{if(!this._validateSolarConfigData()){s.show("Gebruikersprofiel succesvol opgeslagen");o.hide();return Promise.resolve()}return new Promise(e=>{setTimeout(()=>{this._updateSolarConfig().then(t=>{e(t)}).catch(t=>{console.error("Error in solar config update:",t);r.error("Fout bij opslaan configuratie: "+t.message);e(null)})},100)})}).then(e=>{if(e){s.show("Configuratie succesvol opgeslagen")}else{s.show("Gegevens succesvol opgeslagen")}o.hide()}).catch(e=>{console.error("Error saving data:",e);r.error("Fout bij opslaan: "+e.message);o.hide()})},_validateSolarConfigData:function(){const e=this.getView().getModel().getData();const t=this.getView().getModel("address").getData().selectedAddress;return e.PanelsAmount>0&&e.ModulesPower>0&&t.latitude&&t.longitude&&t.displayName},_updateUserProfile:function(){return new Promise((e,t)=>{const r=this.getView().getModel("userProfile").getData();const s={firstName:r.Firstname,lastName:r.Lastname,contractType:r.ContractType};console.log("Updating user profile with data:",s);$.ajax({url:"/userform",type:"GET",headers:{"X-CSRF-Token":"Fetch"},success:(r,o,n)=>{const a=n.getResponseHeader("X-CSRF-Token");$.ajax({url:"/userform/updateUserProfile",type:"POST",contentType:"application/json",headers:{"X-CSRF-Token":a},data:JSON.stringify(s),success:t=>{if(t){this.getView().getModel("userProfile").setData(t)}const r=this.getView().getModel("viewState");r.setProperty("/formMode","update");e(t)},error:e=>{console.error("Error updating user profile:",e.responseText);t(new Error(this._getErrorMessage(e)))}})},error:e=>{console.error("Failed to fetch CSRF token:",e.responseText);t(new Error("Kon beveiligingstoken niet ophalen"))}})})},_updateEnergyRate:function(e){return new Promise((t,r)=>{const s=parseFloat(parseFloat(e).toFixed(4));const o={Price:s};console.log("Updating energy rate with price:",s);$.ajax({url:"/userform",type:"GET",headers:{"X-CSRF-Token":"Fetch"},success:(e,s,n)=>{const a=n.getResponseHeader("X-CSRF-Token");$.ajax({url:"/userform/updateUserEnergyRate",type:"POST",contentType:"application/json",headers:{"X-CSRF-Token":a},data:JSON.stringify(o),success:e=>{if(e){this.getView().getModel("energyRate").setData(e)}t(e)},error:e=>{console.error("Error updating energy rate:",e.responseText);r(new Error(this._getErrorMessage(e)))}})},error:e=>{console.error("Failed to fetch CSRF token for energy rate:",e.responseText);r(new Error("Kon beveiligingstoken niet ophalen"))}})})},_updateSolarConfig:function(){return new Promise((e,t)=>{const r=this.getView().getModel().getData();const s=this.getView().getModel("address").getData().selectedAddress;if(!s.latitude||!s.longitude||!s.displayName){console.error("Missing address data:",s);t(new Error("Adresgegevens ontbreken"));return}const o={panelAmount:r.PanelsAmount,modulePower:r.ModulesPower,panelAngle:r.PanelAngle,panelAzimuth:r.PanelAzimuth,latitude:s.latitude,longitude:s.longitude,location:s.displayName};console.log("Sending solar config payload:",o);$.ajax({url:"/userform",type:"GET",headers:{"X-CSRF-Token":"Fetch"},success:(r,s,n)=>{const a=n.getResponseHeader("X-CSRF-Token");$.ajax({url:"/userform/updateSolarConfig",type:"POST",contentType:"application/json",headers:{"X-CSRF-Token":a},data:JSON.stringify(o),success:t=>{if(!t){console.warn("No data returned from updateSolarConfig");e({});return}this.getView().getModel().setData({PanelsAmount:t.PanelAmount,ModulesPower:t.ModulePower,PanelAngle:t.PanelAngle,PanelAzimuth:t.PanelAzimuth,ID:t.ID});const r=this.getView().getModel("viewState");r.setProperty("/formMode","update");e(t)},error:e=>{console.error("Error updating solar config:",e.responseText);t(new Error(this._getErrorMessage(e)))}})},error:e=>{console.error("Failed to fetch CSRF token for solar config:",e.responseText);t(new Error("Kon beveiligingstoken niet ophalen"))}})})},_updateContractTypeUI:function(){const e=this.getView().getModel("userProfile").getProperty("/ContractType");if(e==="fixed"){this.byId("energyPriceLabel").setVisible(true);this.byId("energyPriceInput").setVisible(true);const e=this.getView().getModel("energyRate");if(!e.getProperty("/ID")){this._fetchEnergyRate()}}else{this.byId("energyPriceLabel").setVisible(false);this.byId("energyPriceInput").setVisible(false)}const t=this.byId("contractTypeGroup");if(t){const r=e==="fixed"?0:1;t.setSelectedIndex(r)}console.log("Contract type UI updated based on:",e)},onContractTypeChange:function(e){const t=e.getParameter("selectedIndex")===0?"fixed":"variable";this.getView().getModel("userProfile").setProperty("/ContractType",t);console.log("Contract type changed to:",t);this._updateContractTypeUI()},_getErrorMessage:function(e){try{const t=JSON.parse(e.responseText);if(t&&t.error&&t.error.message){return t.error.message}}catch(e){}return e.statusText||"Onbekende fout"},_validateForm:function(){let e=true;const t=(e,t,r)=>{const s=this.byId(e);if(s){s.setValueState(t);if(r)s.setValueStateText(r)}};const r=this.getView().getModel("userProfile").getData();if(!r.Firstname||r.Firstname.trim()===""){t("firstNameInput","Error","Voornaam is verplicht");e=false}else{t("firstNameInput","None")}if(!r.Lastname||r.Lastname.trim()===""){t("lastNameInput","Error","Achternaam is verplicht");e=false}else{t("lastNameInput","None")}if(r.ContractType==="fixed"){const r=this.byId("energyPriceInput").getValue();const s=parseFloat(r);if(!r||isNaN(s)||s<=0||s>1){t("energyPriceInput","Error","Voer een geldige prijs in (tussen 0 en 1)");e=false}else{t("energyPriceInput","None")}}const s=this.getView().getModel().getData();if(!s.PanelsAmount||s.PanelsAmount<=0){t("panelsAmountInput","Error","Voer een geldig aantal panelen in");e=false}else{t("panelsAmountInput","None")}if(!s.ModulesPower||s.ModulesPower<=0){t("modulePowerInput","Error","Voer een geldig vermogen in");e=false}else{t("modulePowerInput","None")}const o=this.getView().getModel("address").getData().selectedAddress;if(!o.displayName||o.displayName.trim()===""){t("addressInput","Error","Selecteer een adres");e=false}else{t("addressInput","None")}return e}})});
},
	"userform/i18n/i18n.properties":'# This is the resource bundle for userform\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=User Form\n\n#YDES: Application description\nappDescription=An SAP Fiori application.\n#XTIT: Main view title\ntitle=User Form',
	"userform/manifest.json":'{"_version":"1.65.0","sap.app":{"id":"userform","type":"application","i18n":"i18n/i18n.properties","applicationVersion":{"version":"0.0.1"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:basic","version":"1.17.3","toolsId":"64bc2f65-f3c1-42ea-acc0-0c55f3209388"},"dataSources":{"mainService":{"uri":"odata/v4/energy/","type":"OData","settings":{"annotations":[],"odataVersion":"4.0"}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.134.1","libs":{"sap.m":{},"sap.ui.core":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"userform.i18n.i18n"}},"":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}}},"resources":{"css":[{"uri":"css/style.css"}]},"routing":{"config":{"routerClass":"sap.m.routing.Router","controlAggregation":"pages","controlId":"app","transition":"slide","type":"View","viewType":"XML","path":"userform.view","async":true,"viewPath":"userform.view"},"routes":[{"name":"RouteUserForm","pattern":":?query:","target":["TargetUserForm"]}],"targets":{"TargetUserForm":{"id":"UserForm","name":"UserForm"}}},"rootView":{"viewName":"userform.view.App","type":"XML","id":"App","async":true}}}',
	"userform/model/models.js":function(){
sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/Device"],function(e,n){"use strict";return{createDeviceModel:function(){var i=new e(n);i.setDefaultBindingMode("OneWay");return i}}});
},
	"userform/view/App.view.xml":'<mvc:View controllerName="userform.controller.App"\n    displayBlock="true"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"><App id="app"></App></mvc:View>',
	"userform/view/UserForm.view.xml":'<mvc:View \n    controllerName="userform.controller.UserForm"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:layout="sap.ui.layout"\n    xmlns:f="sap.ui.layout.form"\n    xmlns:core="sap.ui.core"\n    displayBlock="true"><Page id="userFormPage" \n          title="Solar Configuratie"\n          showHeader="true"\n          backgroundDesign="Solid"\n          busy="{viewState>/isBusy}"\n          busyIndicatorDelay="0"><content><f:SimpleForm\n                id="mainForm"\n                editable="true"\n                layout="ResponsiveGridLayout"\n                labelSpanL="3"\n                labelSpanM="3"\n                emptySpanL="1"\n                emptySpanM="1"\n                columnsL="1"\n                columnsM="1"\n                ariaLabelledBy="formTitle"><Title id="personalInfoTitle" text="Persoonlijke Gegevens"><layoutData><layout:GridData span="L12 M12 S12" /></layoutData></Title><Label id="emailLabel" text="Email" labelFor="emailInput"/><Input id="emailInput" value="{userProfile>/Email}" editable="false" width="100%"/><Label id="firstNameLabel" text="Voornaam" required="true" labelFor="firstNameInput"/><Input id="firstNameInput" value="{userProfile>/Firstname}" width="100%" placeholder="Vul uw voornaam in"/><Label id="lastNameLabel" text="Achternaam" required="true" labelFor="lastNameInput"/><Input id="lastNameInput" value="{userProfile>/Lastname}" width="100%" placeholder="Vul uw achternaam in"/><Title id="contractTitle" text="Contract Details"><layoutData><layout:GridData span="L12 M12 S12" /></layoutData></Title><Label id="contractTypeLabel" text="Contract Type" labelFor="contractTypeGroup"/><RadioButtonGroup \n                    id="contractTypeGroup"\n                    selectedKey="{path: \'userProfile>/ContractType\', mode: \'TwoWay\'}"\n                    select=".onContractTypeChange"\n                    columns="2"><RadioButton id="fixedContractRadio" key="fixed" text="Fixed"/><RadioButton id="variableContractRadio" key="variable" text="Variable"/></RadioButtonGroup><Label id="energyPriceLabel" text="Vaste energieprijs (€/kWh)" required="true"\n                    visible="{= ${userProfile>/ContractType} === \'fixed\'}" \n                    labelFor="energyPriceInput"/><Input id="energyPriceInput"\n                    value="{= ${energyRate>/Price} > 0 ? ${energyRate>/Price} : \'\' }"\n                    visible="{= ${userProfile>/ContractType} === \'fixed\'}"\n                    placeholder="Bijv. 0.2250"\n                    type="Number"\n                    min="0.0001"\n                    max="1.0000"\n                    displayFormat="0.0000"\n                    valueFormat="0.0000"\n                    width="200px"/><Label id="lastUpdatedLabel" text="Laatst bijgewerkt" \n                    visible="{= ${userProfile>/ContractType} === \'fixed\' &amp;&amp; ${energyRate>/Date} !== null}" \n                    labelFor="lastUpdatedText"/><Text id="lastUpdatedText" \n                    text="{= ${energyRate>/Date} ? ${energyRate>/Date} + \' \' + ${energyRate>/Time} : \'\' }"\n                    visible="{= ${userProfile>/ContractType} === \'fixed\' &amp;&amp; ${energyRate>/Date} !== null}"/><Title id="solarSettingsTitle" text="Zonnepaneel Instellingen"><layoutData><layout:GridData span="L12 M12 S12" /></layoutData></Title><Label id="panelsAmountLabel" text="Aantal panelen" required="true" labelFor="panelsAmountInput"/><StepInput id="panelsAmountInput" value="{/PanelsAmount}" min="1" max="50" width="200px"/><Label id="modulePowerLabel" text="Vermogen per module (W)" required="true" labelFor="modulePowerInput"/><StepInput id="modulePowerInput" value="{/ModulesPower}" min="100" max="600" step="50" width="200px"/><Label id="panelAngleLabel" text="Paneelhoek (°)" required="true" labelFor="panelAngleInput"/><StepInput id="panelAngleInput" value="{/PanelAngle}" min="0" max="90" width="200px"/><Label id="azimuthLabel" text="Azimut (° t.o.v. zuiden)" required="true" labelFor="azimuthInput"/><StepInput id="azimuthInput" value="{/PanelAzimuth}" min="0" max="360" width="200px"/><Title id="addressTitle" text="Installatie Adres"><layoutData><layout:GridData span="L12 M12 S12" /></layoutData></Title><Label id="addressLabel" text="Adres" required="true" labelFor="addressInput"/><Input id="addressInput"\n                       value="{address>/selectedAddress/displayName}"\n                       showSuggestion="true"\n                       suggest=".onSuggestAddress"\n                       suggestionItems="{path: \'address>/suggestions\'}"\n                       suggestionItemSelected=".onAddressSelected"\n                       required="true"\n                       liveChange=".onSuggestAddress"\n                       placeholder="Zoek uw installatie adres"><suggestionItems><SuggestionItem text="{address>description}" /></suggestionItems></Input><Label id="latitudeLabel" text="Latitude" labelFor="latitudeInput"/><Input id="latitudeInput" value="{address>/selectedAddress/latitude}" editable="false" width="100%"/><Label id="longitudeLabel" text="Longitude" labelFor="longitudeInput"/><Input id="longitudeInput" value="{address>/selectedAddress/longitude}" editable="false" width="100%"/><Toolbar id="formToolbar"><ToolbarSpacer/><Button id="saveButton" \n                            text="{= ${viewState>/formMode} === \'update\' ? \'Bijwerken\' : \'Opslaan\' }" \n                            type="Emphasized" \n                            press=".onSavePress" \n                            width="120px"/></Toolbar></f:SimpleForm></content><footer><Toolbar><ToolbarSpacer/><Text text="{= ${viewState>/formMode} === \'update\' ? \'Laatst bijgewerkt: \' + ${/ModifiedAt} : \'Nieuwe configuratie\' }" \n                      visible="{viewState>/dataLoaded}"/></Toolbar></footer></Page></mvc:View>'
});
//# sourceMappingURL=Component-preload.js.map
